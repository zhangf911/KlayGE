SET(VORBIS_PROJECT_DIR "${EXTERNAL_PROJECT_DIR}/libvorbis")
SET(VORBIS_OUTPUT_DIR "${EXTERNAL_PROJECT_DIR}/lib/libvorbis/${KLAYGE_PLATFORM_NAME}")

UpdateExternalLib("libvorbis" "https://github.com/xiph/vorbis.git" "9eadeccdc4247127d91ac70555074239f5ce3529")

SET(BUILD_SHARED_LIBS OFF)
SET(BUILD_FRAMEWORK OFF)
SET(OGG_ROOT ${VORBIS_PROJECT_DIR}/../libogg)
SET(OGG_LIBRARIES "ogg")
if(KLAYGE_COMPILER_MSVC)
	string(REPLACE "/WX" "/WX:NO" CMAKE_STATIC_LINKER_FLAGS ${CMAKE_STATIC_LINKER_FLAGS})
endif()

ADD_SUBDIRECTORY(${VORBIS_PROJECT_DIR} "${CMAKE_CURRENT_BINARY_DIR}/vorbis")

target_include_directories(vorbis
	PUBLIC
		${VORBIS_PROJECT_DIR}/include
)

SET_TARGET_PROPERTIES(vorbis PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${VORBIS_OUTPUT_DIR}
	PROJECT_LABEL vorbis
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME vorbis_static${KLAYGE_OUTPUT_SUFFIX}
)
SET_TARGET_PROPERTIES(vorbisfile PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${VORBIS_OUTPUT_DIR}
	PROJECT_LABEL vorbisfile
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME vorbisfile_static${KLAYGE_OUTPUT_SUFFIX}
)

foreach(target
	"vorbis" "vorbisfile" "vorbisenc")
	if(KLAYGE_COMPILER_CLANGCL OR KLAYGE_PLATFORM_WINDOWS_STORE)
		target_compile_definitions(${target}
			PRIVATE
				-D_CRT_SECURE_NO_WARNINGS
		)
	endif()
	target_include_directories(${target}
		PUBLIC
			$<TARGET_PROPERTY:ogg,INTERFACE_INCLUDE_DIRECTORIES>
	)

	set_target_properties(${target} PROPERTIES FOLDER "${EXTERNAL_VS_FOLDER_PREFIX}/libvorbis")
endforeach()
